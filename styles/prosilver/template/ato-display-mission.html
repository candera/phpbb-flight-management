<!-- -*- mode: web -*- -->
{% INCLUDECSS '@VFW440_flight_management/ato.css' %}
{% INCLUDECSS 'https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css' %}

{% INCLUDEJS '@VFW440_flight_management/lib/moment.min.js' %}
{% INCLUDEJS '@VFW440_flight_management/lib/moment-timezone-with-data-2012-2022.js' %}
{% INCLUDEJS 'https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js' %}
{% INCLUDEJS '@VFW440_flight_management/ato-display-mission.js' %}

{% INCLUDE 'overall_header.html' %}

<script>
 missiondatetime = '{{ Date | date("Y-m-d\\TH:iO") }}';
</script>

<div class="ato-display-mission">
    <h1>Mission: {{ Name }}
        {% if SHOW_EDIT_MISSION %}
        <a class="ato-button ato-edit-mission-button" href="{{ ATO_EDIT_MISSION_PAGE }}">Edit</a>
        {% endif %}
    </h1>

    <fieldset>
        <legend>Data</legend>
        <table class="mission-details">
            <tr>
                <td class="field-label">
                    <label>Published?</label>
                </td>
                <td class="value">
                    {% if Published %}
                    Yes
                    {% else %}
                    No
                    {% endif %}
                </td>
            </tr>
            <tr>
                <td class="field-label">
                    <label>Open To:</label>
                </td>
                <td class="value">{{ OpenTo }}</td>
            </tr>
            </tr>
            <tr>
                <td class="field-label">
                    <label>Theater:</label>
                </td>
                <td class="value">{{ Theater }}</td>
            </tr>
            <tr>
                <td class="field-label">
                    <label>Mission Type:</label>
                </td>
                <td class="value">{{ Type }}</td>
            </tr>
            <tr>
                <td></td>
                <td id="mission-time-utc"></td>
            </tr>
            <tr>
                <td class="field-label">
                    <label>Date/Time:</label>
                </td>
                <td class="value datetimefields" colspan="2">
                    <div class="missiontime-utc">
                        <span id="missiontime-utc"></span>
                        <span class="utc-label">(GMT)</span>
                    </div>
                    <div id="missiontime"></div>
                </td>
            </tr>
            <tr>
                <td class="field-label">
                    <label>Timezone:</label>
                </td>
                <td class="value">
                    <select class="select2" id="timezones" name="mission-timezone">
                        {% for timezones in loops.timezones %}
                        <option value="{{ timezones.Id }}">{{ timezones.Name }}</option>
                        {% endfor %}
                    </select>
                </td>
                <td>
                    <button class="set-default-timezone ato-button" onclick="setDefaultTimezone()">Set as Default</button>
                </td>
            </tr>
            <tr>
                <td class="field-label">
                    <label>Duration:</label>
                </td>
                <td class="duration">{{ ScheduledDuration / 60 }}:{{ "%02d" | format(ScheduledDuration % 60) }}</td>
            </tr>
            <tr>
                <td class="field-label">
                    <label>Host:</label>
                </td>
                <td class="value">{{ ServerAddress }}</td>
            </tr>
        </table>
    </fieldset>

    <form method="post">
        <fieldset>
            <legend>Flights</legend>

            <!-- Flight summary -->
            <table class="flight-summary">
                <tbody>
                    {% for package in loops.packages %}
                    <tr>
                        <td colspan="4">
                            <div class="package-name">{% include "package-name.html" %}</div>
                        </td>
                    </tr>
                    {% for flight in loops.flights %}
                    {% if flight.PackageId == package.Id %}
                    <tr>
                        <td>{{ flight.CallsignName }}-{{ flight.CallsignNum }}</td>
                        <td>{{ flight.Seats }} x {{ flight.AircraftName }}</td>
                        <td>{{ flight.RoleName }}</td>
                        <td>T/O: {% if flight.TakeoffTime %}
                            {{ flight.TakeoffTime }}
                            {% else %}
                            N/A
                            {% endif %}</td>
                    </tr>
                    {% endif %}
                    {% endfor %}
                    {% endfor %}
                </tbody>
            </table>
        </fieldset>

        <!-- Signin -->
        <fieldset>
            <legend>Pilots</legend>

            <table class="signin">
                <tbody>
                    {% for package in loops.packages %}
                    {% for flight in loops.flights %}
                    {% if flight.PackageId == package.Id %}
                    <tr><td class="flight-header" colspan="3">{{ flight.AircraftName }} {{ flight.RoleName }}</td></tr>
                    {% for seat in 1..flight.Seats %}
                    {% set participant = flight.Participants[seat] %}
                    <tr>
                        <td>{{ flight.CallsignName }} {{ flight.CallsignNum }}-{{ seat }}</td>
                        <td>{% if participant.MemberPilot %}
                            <a href="{{ ROOT_PATH }}/memberlist.php?mode=viewprofile&un={{ participant.MemberPilot }}">{{ participant.MemberPilot }}</a>
                            {% else %}
                            <div class="seat-open">-</span>
                                {% endif %}
                        </td>
                        <td>
                            {% if participant.Action == 'sign-in' %}
                            <input type="Submit"
                                   name="sign-in[{{ flight.Id }}][{{ seat }}]"
                                   value="Sign In"
                                   class="signup-button" />
                            {% elseif participant.Action == 'sign-out' %}
                            <input type="Submit"
                                   name="sign-out[{{ flight.Id }}][{{ seat }}]"
                                   value="Sign Out"
                                   class="signup-button" />
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                    {% endif %}
                    {% endfor %}
                    {% endfor %}
                </tbody>
            </table>
        </fieldset>
    </form>
</div>
{% INCLUDE 'overall_footer.html' %}
